/*!
  * Router-component v0.16.4
  * https://github.com/markcellus/router-component
  *
  * Copyright (c) 2023 Mark
  * Licensed under the MIT license
 */
function __awaiter(t,e,n,o){return new(n||(n=Promise))((function(i,s){function r(t){try{a(o.next(t))}catch(t){s(t)}}function h(t){try{a(o.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,h)}a((o=o.apply(t,e||[])).next())}))}function normalizeSelector(t){function e(){o&&(r.length>0&&/^[~+>]$/.test(r[r.length-1])&&r.push(" "),r.push(o))}var n,o,i,s,r=[],h=[0],a=0,l=/(?:[^\\]|(?:^|[^\\])(?:\\\\)+)$/,c=/^\s+$/,u=[/\s+|\/\*|["'>~+[(]/g,/\s+|\/\*|["'[\]()]/g,/\s+|\/\*|["'[\]()]/g,null,/\*\//g];for(t=t.trim();;){if(o="",(i=u[h[h.length-1]]).lastIndex=a,!(n=i.exec(t))){o=t.substr(a),e();break}if((s=a)<(a=i.lastIndex)-n[0].length&&(o=t.substring(s,a-n[0].length)),h[h.length-1]<3){if(e(),"["===n[0])h.push(1);else if("("===n[0])h.push(2);else if(/^["']$/.test(n[0]))h.push(3),u[3]=new RegExp(n[0],"g");else if("/*"===n[0])h.push(4);else if(/^[\])]$/.test(n[0])&&h.length>0)h.pop();else if(/^(?:\s+|[~+>])$/.test(n[0])&&(r.length>0&&!c.test(r[r.length-1])&&0===h[h.length-1]&&r.push(" "),1===h[h.length-1]&&5===r.length&&"="===r[2].charAt(r[2].length-1)&&(r[4]=" "+r[4]),c.test(n[0])))continue;r.push(n[0])}else r[r.length-1]+=o,l.test(r[r.length-1])&&(4===h[h.length-1]&&(r.length<2||c.test(r[r.length-2])?r.pop():r[r.length-1]=" ",n[0]=""),h.pop()),r[r.length-1]+=n[0]}return r.join("").trim()}function querySelectorDeep(t,e=document,n=null){return _querySelectorDeep(t,!1,e,n)}function _querySelectorDeep(t,e,n,o=null){t=normalizeSelector(t);let i=n.querySelector(t);if(document.head.createShadowRoot||document.head.attachShadow){if(!e&&i)return i;return splitByCharacterUnlessQuoted(t,",").reduce(((t,i)=>{if(!e&&t)return t;const s=splitByCharacterUnlessQuoted(i.replace(/^\s+/g,"").replace(/\s*([>+~]+)\s*/g,"$1")," ").filter((t=>!!t)).map((t=>splitByCharacterUnlessQuoted(t,">"))),r=s.length-1,h=collectAllElementsDeep(s[r][s[r].length-1],n,o),a=findMatchingElement(s,r,n);return e?t=t.concat(h.filter(a)):(t=h.find(a))||null}),e?[]:null)}return e?n.querySelectorAll(t):i}function findMatchingElement(t,e,n){return o=>{let i=e,s=o,r=!1;for(;s&&!isDocumentNode(s);){let e=!0;if(1===t[i].length)e=s.matches(t[i]);else{const o=[].concat(t[i]).reverse();let r=s;for(const t of o){if(!r||!r.matches(t)){e=!1;break}r=findParentOrHost(r,n)}}if(e&&0===i){r=!0;break}e&&i--,s=findParentOrHost(s,n)}return r}}function splitByCharacterUnlessQuoted(t,e){return t.match(/\\?.|^$/g).reduce(((t,n)=>('"'!==n||t.sQuote?"'"!==n||t.quote?t.quote||t.sQuote||n!==e?t.a[t.a.length-1]+=n:t.a.push(""):(t.sQuote^=1,t.a[t.a.length-1]+=n):(t.quote^=1,t.a[t.a.length-1]+=n),t)),{a:[""]}).a}function isDocumentNode(t){return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE||t.nodeType===Node.DOCUMENT_NODE}function findParentOrHost(t,e){const n=t.parentNode;return n&&n.host&&11===n.nodeType?n.host:n===e?null:n}function collectAllElementsDeep(t=null,e,n=null){let o=[];if(n)o=n;else{const t=function(e){for(let n=0;n<e.length;n++){const i=e[n];o.push(i),i.shadowRoot&&t(i.shadowRoot.querySelectorAll("*"))}};e.shadowRoot&&t(e.shadowRoot.querySelectorAll("*")),t(e.querySelectorAll("*"))}return t?o.filter((e=>e.matches(t))):o}function extractPathParams(t,e){const n=new RegExp(t).exec(e);if(n){const t=[...n];return t.shift(),t}return[]}function delay(t=0){return new Promise((e=>{const n=setTimeout((()=>{e(),clearTimeout(n)}),Number(t))}))}const routeComponents=new Set;class RouterComponent extends HTMLElement{constructor(){super(),this.routeElements=[],this.shownRouteElements=new Map,this.show=this.showRoute,routeComponents.add(this),this.fragment=document.createDocumentFragment();const t=this.children;for(;t.length>0;){const e=t[0];this.routeElements.push(e),this.fragment.appendChild(e)}}connectedCallback(){this.popStateChangedListener=this.popStateChanged.bind(this),window.addEventListener("popstate",this.popStateChangedListener),this.bindLinks(),this.historyChangeStates=new Map([[window.history.pushState,"pushState"],[window.history.replaceState,"replaceState"]]);for(const[t,e]of this.historyChangeStates)window.history[e]=(e,n,o)=>{const i=!e||!1!==e.triggerRouteChange;i||delete e.triggerRouteChange,t.call(history,e,n,o),i&&(this.previousLocation&&this.hideRoute(this.previousLocation.pathname),this.showRoute(o))};this.showRoute(this.getFullPathname(this.location))}getRouteElementByPath(t){let e;if(t){for(const n of this.routeElements){let o=t;const i=n.getAttribute("search-params");if(i&&(o=`${t}?${i}`),this.matchPathWithRegex(o,n.getAttribute("path"))){e=n;break}}return e}}get storedScrollPosition(){const t=sessionStorage.getItem("currentScrollPosition");return t&&Number(t)}set storedScrollPosition(t){sessionStorage.setItem("currentScrollPosition",t.toString())}scrollToHash(t=this.location.hash){const e=this.getAttribute("hash-scroll-behavior"),n=t.replace("#","");try{const t=querySelectorDeep(`[id=${n}]`,this);t&&t.scrollIntoView({behavior:e||"auto"})}catch(t){return void console.warn(`Cannot scroll to element with the id of "${n}".`)}}handleHash(t="",e=!1){const n=this.getAttribute("hash-scroll-delay"),o=n?Number(n):1;if(e){const e=setTimeout((()=>{this.scrollToHash(t),clearTimeout(e)}),o)}else this.scrollToHash(t)}showRoute(t){return __awaiter(this,void 0,void 0,(function*(){if(!t)return;const[e,n]=t.split("#"),o=this.getRouteElementByPath(e);if(this.previousLocation=Object.assign({},this.location),!o)return console.warn(`Navigated to path "${e}" but there is no matching element with a path that matches. Maybe you should implement a catch-all route with the path attribute of ".*"?`);const i=this.children[0];i&&this.previousLocation.href!==this.location.href&&!querySelectorDeep("router-component",i)&&this.hideRoute(this.previousLocation.pathname),this.shownRouteElements.has(e)||this.shownRouteElements.set(e,o),this.dispatchEvent(new CustomEvent("route-changed")),this.appendChild(o),this.dispatchEvent(new CustomEvent("showing-page",{detail:o}));const s=this.getAttribute("show-delay");s&&(yield delay(s)),this.setupElement(o);let r=0;this.storedScrollPosition&&"manual"===window.history.scrollRestoration&&(r=this.storedScrollPosition,sessionStorage.removeItem("currentScrollPosition")),n?this.handleHash(`#${n}`):window.scrollTo({top:r,behavior:"auto"})}))}hideRoute(t=""){return __awaiter(this,void 0,void 0,(function*(){if(!t)return;const[e]=t.split("#"),n=this.getRouteElementByPath(e);if(!n)return;this.dispatchEvent(new CustomEvent("hiding-page",{detail:n}));const o=this.getAttribute("hide-delay");o&&(yield delay(o)),this.fragment.appendChild(n),this.teardownElement(n)}))}get location(){return window.location}disconnectedCallback(){window.removeEventListener("popstate",this.popStateChangedListener);for(const[t,e]of this.historyChangeStates)window.history[e]=t;this.unbindLinks(),this.shownRouteElements.clear(),this.previousLocation=void 0}clickedLink(t,e){const{href:n}=t;if(!n||-1!==n.indexOf("mailto:"))return;const{location:o}=this,i=o.origin||o.protocol+"//"+o.host;if(0!==n.indexOf(i)||t.origin!==o.origin)return window.history.scrollRestoration="manual",void sessionStorage.setItem("currentScrollPosition",document.documentElement.scrollTop.toString());e.preventDefault();const s={};t.hash&&t.pathname===o.pathname&&(this.scrollToHash(t.hash),s.triggerRouteChange=!1),window.history.pushState(s,document.title,`${t.pathname}${t.search}${t.hash}`)}bindLinks(){this.clickedLinkListener=t=>{if(t.defaultPrevented)return;const e=t.composedPath().filter((t=>"A"===t.tagName))[0];e&&this.clickedLink(e,t)},document.body.addEventListener("click",this.clickedLinkListener)}unbindLinks(){document.body.removeEventListener("click",this.clickedLinkListener)}matchPathWithRegex(t="",e){return t.startsWith("/")||(t=`${t.replace(/^\//,"")}`),t.match(e)}getFullPathname(t){if(!t)return"";const{pathname:e,search:n,hash:o}=t;return`${e}${n}${o}`}popStateChanged(){return __awaiter(this,void 0,void 0,(function*(){const t=this.getFullPathname(this.location);window.history.replaceState({},document.title,t)}))}setupElement(t){const{pathname:e}=this.location;this.originalDocumentTitle=document.title;const n=t.getAttribute("document-title");document.title=n||this.originalDocumentTitle;const o=t.querySelector("router-component");o&&o.showRoute(e)}teardownElement(t){document.title=this.originalDocumentTitle}getExternalRouterByPath(t){for(const e of routeComponents){if(e.getRouteElementByPath(t))return e}}}customElements.define("router-component",RouterComponent);export{RouterComponent,extractPathParams};
